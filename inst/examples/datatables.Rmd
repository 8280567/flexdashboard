---
output: 
  html_document:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DT)
```

<div class="dt-container" style="width: 100%; height: 650px; background-color: #DCDCDC;">

```{r, echo=FALSE}
mtcars2 <- mtcars[, c("mpg", "cyl", "disp")]
mtcars2 <- mtcars
datatable(mtcars2, filter = "top", options = list(
  scrollY = "300px"
))
```

</div>

<script type="text/javascript">

function findDataTable(el) {
  if (el) {
    var table = $(el).find('table');
    if (table) {
      var dataTable = $(table).dataTable();
      return dataTable;
    }
  }
  // not found
  return null;
}

function dataTableScrollY(dataTable, availableHeight) {
  return (availableHeight / 2) + 'px'
}

// https://datatables.net/forums/discussion/10219/make-sscrolly-dynamic
// var oSettings = myTable.fnSettings();
// oSettings.oScroll.sY = NewHeight + "px";
// myTable.fnDraw();

// find the DT resize handler and replace it
var widgets = HTMLWidgets.widgets;
for (var i=0; i<widgets.length; i++) {
  var widget = widgets[i];
  if (widget.name === "datatables") {
  
    // monkey patch (post-process) renderValue to set scrollX = TRUE
    var previousRenderValue = widget.renderValue;
    widget.renderValue = function(el, x, instance) {
      
      previousRenderValue(el, x, instance);
      var dataTable = findDataTable(el);
      if (dataTable) {
        var settings = dataTable.fnSettings();
        settings.oScroll.sX = TRUE; 
        settings.oScroll.sY = dataTableScrollY(dataTable, $(el).innerHeight()); 
        dataTable.fnDraw();
      }
    }
    
    // monkey patch (pre-process) resize to set scrollY dynamically
    var previousResize = widget.resize;
    widget.resize = function(el, width, height, instance) {
      
      // set the sScrollY on the table dynamically
      var dataTable = findDataTable(el);
      if (dataTable) {
        var settings = dataTable.fnSettings();
        settings.oScroll.sY = dataTableScrollY(dataTable, height); 
        dataTable.fnDraw();
      }
      
      // call previous resize handler
      if (previousResize) 
        previousResize(el, width, height, instance);
    };
  }
}


</script>

